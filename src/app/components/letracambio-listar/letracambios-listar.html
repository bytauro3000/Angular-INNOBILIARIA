<div class="letras-container">
  <h2 class="titulo">Letras de Cambio del Contrato #{{ idContrato }}</h2>

  <div class="filtros">
    <label for="buscar-input" class="label-buscar">Buscar:</label>
    <input
      id="buscar-input"
      type="text"
      placeholder="Número de letra..."
      [(ngModel)]="terminoBusqueda"
      (input)="filtrarLetras()"
      class="filtro-input"
      aria-label="Buscar número de letra"
    />
    <button
      (click)="eliminarLetras()"
      [disabled]="cargando || letras.length === 0"
      class="btn-eliminar"
      aria-disabled="{{ cargando || letras.length === 0 }}"
    >
      Eliminar Letras
    </button>

     <!-- Botón para imprimir el reporte en PDF -->
  <button
    (click)="imprimirLetras()"
    [disabled]="cargando || letras.length === 0"
    class="btn-imprimir"
    aria-disabled="{{ cargando || letras.length === 0 }}"
  >
    Imprimir Letras
  </button>

  <button
    (click)="imprimirCronogramaPagos()"
    [disabled]="cargando || letras.length === 0"
    class="btn-imprimir"
    aria-disabled="{{ cargando || letras.length === 0 }}"
  >
    Cronograma de Pagos
  </button>
  </div>

  <div *ngIf="cargando" class="mensaje-cargando" role="status" aria-live="polite">Cargando letras...</div>
  <div *ngIf="error" class="alerta-error" role="alert">{{ error }}</div>

  <div class="tabla-letras">
    <table *ngIf="!cargando && paginatedLetras.length > 0" role="table" aria-label="Tabla de letras de cambio">
      <thead>
        <tr>
          <th scope="col">#</th>
          <th scope="col">Número Letra</th>
          <th scope="col">Fecha Giro</th>
          <th scope="col">Fecha Vencimiento</th>
          <th scope="col">Importe</th>
          <th scope="col">Importe Texto</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let letra of paginatedLetras; let i = index">
          <td>{{ (currentPage - 1) * pageSize + i + 1 }}</td>
          <td>{{ letra.numeroLetra }}</td>
          <td>{{ letra.fechaGiro | date: 'dd/MM/yyyy' }}</td>
          <td>{{ letra.fechaVencimiento | date: 'dd/MM/yyyy' }}</td>

          <!-- IMPORTE (editable) -->
          <td (dblclick)="iniciarEdicion(letra, 'importe')" tabindex="0" role="textbox" aria-label="Editar importe">
            <input
              *ngIf="editingLetraId === letra.idLetra && campoEditando === 'importe'"
              [value]="valorTemporal"
              (input)="onImporteInput(letra, $event.target.value)"
              (blur)="guardarEdicion(letra)"
              (keydown.enter)="guardarEdicion(letra)"
              (keydown.escape)="cancelarEdicion()"
              class="input-edicion"
              type="number"
              step="0.01"
              autofocus
              aria-live="polite"
            />
            <span *ngIf="!(editingLetraId === letra.idLetra && campoEditando === 'importe')">
              ${{ letra.importe | number: '1.2-2' }}
            </span>
          </td>

          <!-- IMPORTE LETRAS (solo lectura, no editable) -->
          <td>
            <!-- Cambié input disabled por un span para mejor accesibilidad -->
            <span class="importe-texto" aria-readonly="true">{{ letra.importeLetras }}</span>
          </td>
        </tr>
      </tbody>
    </table>

    <div *ngIf="!cargando && paginatedLetras.length === 0" class="no-results" role="alert" aria-live="polite">
      No se encontraron letras que coincidan con el número ingresado.
    </div>
  </div>

  <div *ngIf="totalPages > 1" class="paginacion-controles" role="navigation" aria-label="Paginación">
    <button (click)="previousPage()" [disabled]="currentPage === 1" class="pagina-btn" aria-disabled="{{ currentPage === 1 }}">
      Anterior
    </button>

    <button
      *ngFor="let page of getPagesArray()"
      (click)="goToPage(page)"
      [class.active]="page === currentPage"
      class="pagina-numero-btn"
      aria-current="{{ page === currentPage ? 'page' : null }}"
    >
      {{ page }}
    </button>

    <button (click)="nextPage()" [disabled]="currentPage === totalPages" class="pagina-btn" aria-disabled="{{ currentPage === totalPages }}">
      Siguiente
    </button>
  </div>
</div>
