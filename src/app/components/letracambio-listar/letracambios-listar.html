<div class="letras-container">
  <h2 class="titulo">Letras de Cambio del Contrato #{{ idContrato }}</h2>

  <div class="filtros">
    <label for="buscar-input" class="label-buscar">Buscar:</label>

    <input
      id="buscar-input"
      type="text"
      placeholder="Número de letra..."
      [(ngModel)]="terminoBusqueda"
      (input)="filtrarLetras()"
      class="filtro-input"
      aria-label="Buscar número de letra"
    />

    <div class="acciones-botones">
      <button
        (click)="eliminarLetras()"
        [disabled]="cargando || letras.length === 0"
        class="btn-eliminar"
      >
        <fa-icon [icon]="faTrash" class="icono-btn"></fa-icon> 
        <span>Eliminar Letras</span>
      </button>

      <button
        (click)="imprimirLetras()"
        [disabled]="cargando || letras.length === 0"
        class="btn-imprimirletra"
      >
        <fa-icon [icon]="faPrint" class="icono-btn"></fa-icon> 
        <span>Imprimir Letras</span>
      </button>

      <button
        (click)="imprimirCronogramaPagos()"
        [disabled]="cargando || letras.length === 0"
        class="btn-imprimircronograma"
      >
        <fa-icon [icon]="faCalendarAlt" class="icono-btn"></fa-icon> 
        <span>Cronograma de Pagos</span>
      </button>
    </div>
  </div>

  <div *ngIf="cargando" class="mensaje-cargando" role="status" aria-live="polite">
    Cargando letras...
  </div>

  <div *ngIf="error" class="alerta-error" role="alert">{{ error }}</div>

  <div class="tabla-letras">
    <table *ngIf="!cargando && paginatedLetras.length > 0">
      <thead>
        <tr>
          <th>#</th>
          <th>Número Letra</th>
          <th>Fecha Giro</th>
          <th>Fecha Vencimiento</th>
          <th>Importe</th>
          <th>Importe Texto</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let letra of paginatedLetras; let i = index">
          <td data-label="#">{{ (currentPage - 1) * pageSize + i + 1 }}</td>
          <td data-label="Número Letra">{{ letra.numeroLetra }}</td>
          <td data-label="Fecha Giro">{{ letra.fechaGiro | date: 'dd/MM/yyyy' }}</td>
          <td data-label="Fecha Vencimiento">{{ letra.fechaVencimiento | date: 'dd/MM/yyyy' }}</td>

          <td data-label="Importe" (dblclick)="iniciarEdicion(letra, 'importe')" class="celda-importe">
            <input
              *ngIf="editingLetraId === letra.idLetra && campoEditando === 'importe'"
              [value]="valorTemporal"
              (input)="onImporteInput(letra, $any($event.target).value)"
              (blur)="guardarEdicion(letra)"
              (keydown.enter)="guardarEdicion(letra)"
              (keydown.escape)="cancelarEdicion()"
              class="input-edicion"
              type="number"
              step="0.01"
              autofocus
            />
            <span *ngIf="!(editingLetraId === letra.idLetra && campoEditando === 'importe')">
              ${{ letra.importe | number: '1.2-2' }}
            </span>
          </td>

          <td data-label="Importe Texto">
            <span class="importe-texto">{{ letra.importeLetras }}</span>
          </td>
        </tr>
      </tbody>
    </table>

    <div *ngIf="!cargando && paginatedLetras.length === 0" class="no-results">
      No se encontraron letras registradas.
    </div>
  </div>

  <div *ngIf="totalPages > 1" class="paginacion-controles">
  <button (click)="previousPage()" [disabled]="currentPage === 1" class="pagina-btn">
    Anterior
  </button>

  <ng-container *ngFor="let page of getPagesArray()">
    <button *ngIf="page !== '...'" 
            (click)="goToPage($any(page))" 
            [class.active]="page === currentPage" 
            class="pagina-numero-btn">
      {{ page }}
    </button>

    <span *ngIf="page === '...'" class="ellipsis-spacer">...</span>
  </ng-container>

  <button (click)="nextPage()" [disabled]="currentPage === totalPages" class="pagina-btn">
    Siguiente
  </button>
</div>
</div>