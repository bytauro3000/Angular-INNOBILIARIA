<div class="contenedor-lotes">
  <h1 id="titPrin" class="mb-4">Gestión de Lotes</h1>

  <div class="filtros row g-2 mb-2">
    <div class="col-sm-3">
      <input type="text" class="form-control form-control-sm" placeholder="Filtrar por manzana..."
             [(ngModel)]="filtroManzana" (input)="filtrarLotes()" />
    </div>

    <div class="col-sm-3">
      <select class="form-select form-select-sm" [(ngModel)]="filtroEstado" (change)="filtrarLotes()">
        <option value="">Todos los estados</option>
        <option *ngFor="let estado of ['Disponible', 'Separado', 'Vendido']" [value]="estado">{{ estado }}</option>
      </select>
    </div>

    <div class="col-sm-3">
      <input type="number" class="form-control form-control-sm" placeholder="Filtrar por precio m²..."
             [(ngModel)]="filtroPrecioM2" (input)="filtrarLotes()" />
    </div>
  </div>

  <div class="d-flex justify-content-end mb-3">
    <button class="btn btn-success btn-sm" (click)="abrirCrearLote()">
      <i class="bi bi-plus-lg"></i> Crear lote
    </button>
  </div>

  <div class="table-responsive shadow-sm rounded">
    <table class="table table-sm table-hover align-middle tabla-ajustada">
      <thead class="table-dark">
        <tr>
          <th>Id</th>
          <th>Manzana</th>
          <th>N° Lote</th>
          <th>Área</th>
          <th>Precio/m²</th>
          <th>Programa</th>
          <th>Estado</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let lote of paginatedLotes">
          <td>{{ lote.idLote }}</td>
          <td>{{ lote.manzana }}</td>
          <td>{{ lote.numeroLote }}</td>
          <td>{{ lote.area }}</td>
          <td>{{ lote.precioM2 | currency:'PEN':'symbol':'1.0-0' }}</td>
          <td>{{ lote.programaNombre }}</td>
          <td>
            <span class="badge"
                  [ngClass]="{
                    'bg-success': lote.estado === 'Disponible',
                    'bg-warning text-dark': lote.estado === 'Separado',
                    'bg-danger': lote.estado === 'Vendido'
                  }">
              {{ lote.estado }}
            </span>
          </td>
          <td>
            <button class="btn btn-outline-info btn-sm me-1" (click)="mostrarDetalle(lote)">
              <i class="bi bi-eye"></i>
            </button>
            <button class="btn btn-outline-primary btn-sm me-1" (click)="abrirEditarLote(lote)">
              <i class="bi bi-pencil"></i>
            </button>
            <button class="btn btn-outline-danger btn-sm" (click)="mostrarEliminar(lote)">
              <i class="bi bi-trash"></i>
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="d-flex justify-content-between align-items-center mt-2">
    <small class="text-muted">
      Página {{ currentPage }} de {{ totalPages }}
    </small>

    <nav>
      <ul class="pagination pagination-sm mb-0">
        <li class="page-item" [class.disabled]="currentPage === 1">
          <button class="page-link" (click)="previousPage()">Anterior</button>
        </li>
        <li class="page-item" *ngFor="let page of getPagesArray()" [class.active]="page === currentPage">
          <button class="page-link" (click)="goToPage(page)">{{ page }}</button>
        </li>
        <li class="page-item" [class.disabled]="currentPage === totalPages">
          <button class="page-link" (click)="nextPage()">Siguiente</button>
        </li>
      </ul>
    </nav>
  </div>

  <app-lotes-insertar-editar #loteModal (loteGuardado)="cargarLotes()"></app-lotes-insertar-editar>

</div>