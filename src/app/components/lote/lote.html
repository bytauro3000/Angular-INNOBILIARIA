<div class="lotes-container">
  <h2>Gestión de Lotes</h2>

  <div class="filtros-header">
    <div class="selector-programa">
  <label for="progSelect">Filtrar por Programa:</label>
  <select id="progSelect" class="form-select" [(ngModel)]="idProgramaSeleccionado" (change)="onProgramaChange()">
    <option [value]="null" disabled>-- Seleccione un programa --</option>
    <option *ngFor="let prog of programas" [value]="prog.idPrograma">
      {{ prog.nombrePrograma }}
    </option>
  </select>
</div>

    <button (click)="abrirCrearLote()" class="btn btn-success btn-agregar">
      <i class="bi bi-plus-lg"></i> <span>Crear Lote</span>
    </button>
  </div>

  <div class="tabla-lotes">
    <table>
      <thead>
        <tr>
          <th>Id</th>
          <th>Manzana</th>
          <th>N° Lote</th>
          <th>Área</th>
          <th>Precio/m²</th>
          <th>Programa</th>
          <th>Estado</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let lote of paginatedLotes">
          <td data-label="Id">{{ lote.idLote }}</td>
          <td data-label="Manzana">{{ lote.manzana }}</td>
          <td data-label="N° Lote">{{ lote.numeroLote }}</td>
          <td data-label="Área">{{ lote.area }} m²</td>
          <td data-label="Precio/m²">{{ lote.precioM2 | currency:'USD':'symbol':'1.2-2' }}</td>
          <td data-label="Programa">{{ lote.programaNombre }}</td>
          <td data-label="Estado">
            <span class="badge"
                  [ngClass]="{
                    'bg-success': lote.estado === 'Disponible',
                    'bg-warning text-dark': lote.estado === 'Separado',
                    'bg-danger': lote.estado === 'Vendido'
                  }">
              {{ lote.estado }}
            </span>
          </td>
          <td class="acciones-cell">
            <button class="btn btn-outline-info btn-sm me-1" (click)="mostrarDetalle(lote)" title="Ver detalle">
              <i class="bi bi-eye"></i>
            </button>
            <button class="btn btn-outline-primary btn-sm me-1" (click)="abrirEditarLote(lote)" title="Editar">
              <i class="bi bi-pencil"></i>
            </button>
            <button class="btn btn-outline-danger btn-sm" (click)="mostrarEliminar(lote)" title="Eliminar">
              <i class="bi bi-trash"></i>
            </button>
          </td>
        </tr>
      </tbody>
    </table>
    <div *ngIf="paginatedLotes.length === 0" class="no-results">
      {{ idProgramaSeleccionado ? 'No hay lotes en este programa.' : 'Seleccione un programa para ver los lotes.' }}
    </div>
  </div>

  <div *ngIf="totalPages > 1" class="paginacion-controles">
    <button (click)="previousPage()" [disabled]="currentPage === 1" class="btn btn-outline-secondary">Anterior</button>
    <button *ngFor="let page of getPagesArray()" (click)="goToPage(page)" [class.active]="currentPage === page"
      class="btn pagina-numero-btn">
      {{ page }}
    </button>
    <button (click)="nextPage()" [disabled]="currentPage === totalPages" class="btn btn-outline-secondary">Siguiente</button>
  </div>

  <app-lotes-insertar-editar #loteModal (loteGuardado)="onProgramaChange()"></app-lotes-insertar-editar>
</div>